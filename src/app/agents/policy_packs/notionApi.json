{
  "id": "notion_policy_v1",
  "match": {
    "source_servers": ["notionApi"]
  },
  "inject": {
    "append_system_message": [
      "NOTION CONTEXT:",
      "NOTES_PARENT_PAGE_ID={{NOTES_PARENT_PAGE_ID}}",
      "- Never invent page/database IDs. If missing, ask where to save/search.",
      "",
      "WRITE RULES:",
      "- For SAVE/NOTE/REMEMBER/ADD/STORE: create a NEW page with notionApi_API-post-page under parent.page_id=NOTES_PARENT_PAGE_ID.",
      "- If you don't have notionApi_API-post-page, transfer back to supervisor.",
      "",
      "READ RULES:",
      "- For retrieval questions: search first, then retrieve the most relevant page (and blocks/children if needed) to answer with the actual content + link.",
      "",
      "VALIDATION/REPAIR:",
      "- On Notion 400 validation_error or schema validation_error: fix payload and retry once; if it repeats, ask a clarification.",
      "",
      "CRITICAL SHAPE:",
      "- children is TOP-LEVEL (sibling of properties), never inside properties.",
      "- properties contains ONLY property values.",
      "- Title shape: {\"properties\": {\"title\": {\"title\": [{\"type\":\"text\",\"text\":{\"content\":\"...\"}}]}}}",
      "",
      "CREATE PAGE MIN TEMPLATE:",
      "{ \"parent\": {\"page_id\": NOTES_PARENT_PAGE_ID}, \"properties\": {\"title\": {\"title\": [{\"type\":\"text\",\"text\":{\"content\":\"<TITLE>\"}}]}} , \"children\": [] }"
    ]
  }
}

